<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FREEBOOK4ALL - Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json">
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Navbar -->
  <nav class="bg-white shadow-md p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-blue-600">üìö FREEBOOK4ALL</h1>
    <div class="space-x-4">
      <a href="index.html" class="text-blue-600 hover:underline">Home</a>
      <a href="upload.html" class="text-blue-600 hover:underline">Upload</a>
      <a href="admin.html" class="text-blue-600 hover:underline">Admin</a>
      <a href="suggest-link.html" class="text-blue-600 hover:underline">Suggest Link</a>
      <a href="vault.html" class="text-purple-600 hover:underline">üîê Vault</a>
    </div>
  </nav>

  <!-- Search and Filters -->
  <div class="p-4">
    <input type="text" id="searchBar" placeholder="Search PDF, Link or HTML..." class="p-2 border w-full rounded mb-4" />

    <div class="grid grid-cols-4 gap-4 mb-4">
      <select id="filterName" class="p-2 border rounded">
        <option value="">Filter by Name</option>
        <option value="az">A-Z</option>
        <option value="za">Z-A</option>
      </select>

      <select id="filterSize" class="p-2 border rounded">
        <option value="">Filter by Size</option>
        <option value="big">Largest First</option>
        <option value="small">Smallest First</option>
      </select>

      <select id="filterDate" class="p-2 border rounded">
        <option value="">Filter by Date</option>
        <option value="new">Newest First</option>
        <option value="old">Oldest First</option>
      </select>

      <select id="filterType" class="p-2 border rounded">
        <option value="">All Types</option>
        <option value="PDF">PDF</option>
        <option value="LINK">Link</option>
        <option value="HTML">HTML</option>
      </select>
    </div>

    <!-- Upload Buttons -->
    <div class="mb-4 space-x-2">
      <a href="upload.html" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">üì§ Create Folder & Upload PDF</a>
      <a href="#" onclick="document.getElementById('folderInput').click()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">üìÅ Upload Folder</a>
      <input type="file" id="folderInput" webkitdirectory directory multiple hidden />
    </div>

    <!-- Upload Status -->
    <div id="status" class="text-center text-sm mt-2 mb-4"></div>

    <!-- Stats -->
    <div id="stats" class="bg-white shadow p-4 rounded mb-4">
      <h2 class="text-lg font-bold mb-2">üìä Site Stats</h2>
      <p>Total PDFs: <span id="totalPDFs">0</span></p>
      <p>Total Links: <span id="totalLinks">0</span></p>
      <p>Total HTMLs: <span id="totalHTMLs">0</span></p>
      <p>Total Visitors: <span id="totalVisitors">0</span></p>
    </div>

    <!-- File List -->
    <div id="fileList" class="grid gap-4"></div>

    <!-- About Section -->
    <div class="bg-white shadow p-4 rounded mt-6">
      <h2 class="text-lg font-bold mb-2">‚ÑπÔ∏è About FREEBOOK4ALL</h2>
      <p>
        Welcome to FREEBOOK4ALL ‚Äì a public library for knowledge lovers. Here, anyone can share useful books or links for others to access. 
        All content is admin-approved to ensure quality. Feel free to explore, contribute, and learn!
      </p>
    </div>
  </div>

  <!-- Main JavaScript -->
  <script src="script.js"></script>

  <!-- Upload Folder Logic: Supports PDF + HTML -->
  <script>
    document.getElementById('folderInput').addEventListener('change', async function (e) {
      const files = Array.from(e.target.files).filter(file =>
        file.name.endsWith('.pdf') || file.name.endsWith('.html')
      );

      const status = document.getElementById('status');
      if (files.length === 0) {
        status.textContent = "‚ùå No PDF or HTML files found in the folder.";
        status.className = "text-red-600";
        return;
      }

      const senderName = prompt("Enter your name:");
      const senderEmail = prompt("Enter your email:");
      if (!senderName || !senderEmail) {
        alert("Upload cancelled. Name and email are required.");
        return;
      }

      status.textContent = "üì§ Uploading folder...";
      status.className = "text-yellow-600";

      let uploaded = 0;
      for (const file of files) {
        const reader = new FileReader();
        reader.onload = async function () {
          const base64 = reader.result.split(',')[1];
          const action = file.name.endsWith('.pdf') ? 'upload_pdf' : 'upload_html';

          try {
            const res = await fetch("https://script.google.com/macros/s/AKfycbzy9qqIXCKYhC3HB5zJQ0SI_vSTyrUyp7oODVLayFRMYoi66dVSNtHZhOEvi6Lss-3Q/exec", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: new URLSearchParams({
                action,
                file: base64,
                filename: file.name,
                senderName,
                senderEmail
              })
            });

            const result = await res.text();
            uploaded++;
            if (uploaded === files.length) {
              status.textContent = "‚úÖ Folder uploaded successfully!";
              status.className = "text-green-600";
            }
          } catch (err) {
            console.error(err);
            status.textContent = "‚ùå Some uploads failed. Check console.";
            status.className = "text-red-600";
          }
        };
        reader.readAsDataURL(file);
      }
    });
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('‚úÖ Service Worker Registered'))
        .catch(error => console.error('‚ùå Service Worker Registration Failed:', error));
    }
  </script>

</body>
</html>
